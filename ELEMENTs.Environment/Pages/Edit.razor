@page "/edit"
@page "/edit/{ItemType}"
@page "/edit/{ItemType}/{GUID}"

@inject ISQLiteService sql
@using ELEMENTS.Infrastructure


<ELEMENTS.Controls.Layouts.ViewPageLayout Title="@Title" SubTitle="ItemType">
    <HeaderContent>
        <ELEMENTS.Controls.Collection.AddItem Title="Eintrag hinzufügen"
                                              FieldHeader="Bezeichnung" Repository="@AddRepo" />
    </HeaderContent>
    <ChildContent>
        <ELEMENTS.Controls.Edit.EditArea Fields="@Fields">

        </ELEMENTS.Controls.Edit.EditArea>
    </ChildContent>
</ELEMENTS.Controls.Layouts.ViewPageLayout>

@code {


    [Parameter]
    public string ItemType { get; set; }

    [Parameter]
    public string GUID { get; set; }

    private IAddItemRepository AddRepo = new AddItemRepository();
    private IEditItemRepository EditRepository = new EditItemRepository();
    private List<EditField> Fields { get; set; } = new List<EditField>();

    private string Title = string.Empty;

    protected override void OnInitialized()
    {
        base.OnInitialized();

        if (AddRepo != null)
        {
            AddRepo.Service = sql;
        }
        if (EditRepository != null)
        {
            EditRepository.Service = sql;

            if (!string.IsNullOrEmpty(GUID))
            {
                EditRepository.ItemGUID = new Guid(GUID);
            }

            EditRepository.Init();
        }

        // Edit Fields 
        SetFields();
    }

    protected override void OnParametersSet()
    {
        base.OnParametersSet();

        if (EditRepository != null)
        {
            if (EditRepository.DTO != null)
            {
                Title = EditRepository.DTO.Title;
            }
        }
    }

    private void SetFields()
    {
        Fields = new List<EditField>();

        Fields.Add(new EditField() { Title = "ID", ColumnCSSClass = "col-4", Type = EditFieldType.TextBox });
        Fields.Add(new EditField() { Title = "Title", ColumnCSSClass = "col-4", Type = EditFieldType.TextBox });
        Fields.Add(new EditField() { Title = "Position", ColumnCSSClass = "col-4", Type = EditFieldType.TextBox });

        Fields.Add(new EditField() { Title = "Name", ColumnCSSClass = "col-6", Type = EditFieldType.TextBox });
        Fields.Add(new EditField() { Title = "Vorname", ColumnCSSClass = "col-6", Type = EditFieldType.TextBox });
    }

}
